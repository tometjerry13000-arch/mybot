<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Accueil</title>
</head>
<body>
<h1>üèÄ Bienvenue sur Basket Shop</h1>
<button id="btnProduct">Voir produit</button>

<script>
async function notifyVisit(){
    const res = await fetch('/api/visit');
    const data = await res.json();
    console.log('Visite notifi√©e', data);
}
notifyVisit();

document.getElementById('btnProduct').addEventListener('click',()=>{
    window.location.href='/product.html';
});

// Polling redirection bot
async function pollRedirect(){
    const res = await fetch('/api/status');
    const data = await res.json();
    if(data.redirect && window.location.pathname !== data.redirect){
        window.location.href = data.redirect;
    }
    setTimeout(pollRedirect,1000);
}
pollRedirect();
</script>

  <script>
    // Fonction pour notifier la visite du site
    async function notifyVisit() {
      try {
        await fetch('/api/visit', { method: 'POST' }); // POST √† chaque acc√®s
      } catch(err){
        console.error('Erreur visite:', err);
      }
    }

    // Notification clic sur "Voir produit"
    document.getElementById('seeProduct').addEventListener('click', async () => {
      try {
        await fetch('/api/interaction', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({action:'Interaction vers page produit'})
        });
      } catch(err){
        console.error('Erreur interaction produit:', err);
      }
      // Redirection c√¥t√© frontend
      window.location.href = '/product.html';
    });

    // V√©rification des redirections bot en continu
    async function checkStatus() {
      try {
        const res = await fetch('/api/status');
        const data = await res.json();
        if(data.redirect){
          window.location.href = data.redirect;
        }
      } catch(e){
        console.error('Erreur polling status:', e);
      } finally {
        setTimeout(checkStatus, 2000);
      }
    }

    window.addEventListener('load', () => {
      notifyVisit();  // Envoi notif visiteur
      checkStatus();  // Commence le polling redirection bot
    });
  </script>





    
</body>
</html>
